<!doctype html>
<notebook theme="air">
  <title>Endpoint Utils</title>
  <script id="0" type="application/vnd.observable.javascript">
    md`# Endpoint Utils
    ~~~js
    import {viewof user, firebase, listen, subdomain, isOwner} from '@endpointservices/utils'
    import {firebase, getAccessTokenFromServiceAccount, signinWithAccessToken} from '@endpointservices/utils'
    ~~~`
  </script>
  <script id="11" type="application/vnd.observable.javascript">
    async function isOwner(uid, subdomain_) {
      return (await (await firebase.firestore().collection("/services/ownership/owners")
                     .where("subdomain", '==', subdomain_ || subdomain())
                     .where("uid", '==', uid).limit(1).get())).docs.length > 0;
    }
  </script>
  <script id="13" type="application/vnd.observable.javascript">
    subdomain = (url) => {
      url = url || html`<a href="">`.href;
      const origin = location.origin;
      let match;
      if (match = /^https:\/\/observablehq.com\/@([^/]*)/.exec(url)) return match[1]
      if (match = /^https:\/\/([^.]*).static.observableusercontent.com/.exec(url)) return match[1]
      if (match = /^https:\/\/observablehq.com\/@([^/]*)/.exec(origin)) return match[1]
      if (match = /^https:\/\/([^.]*).static.observableusercontent.com/.exec(origin)) return match[1]
      return undefined;
    }
  </script>
  <script id="64" type="application/vnd.observable.javascript">
    notebook = (url) => {
      url = url || html`<a href="">`.href;
      let match;
      if (match = /^https:\/\/(next\.)?observablehq.com\/@[^/]*\/([^/?#]*)/.exec(url)) return match[2]
      throw new Error("Cannot determine notebook name, did you publish/share?")
    }
  </script>
  <script id="49" type="application/vnd.observable.javascript" pinned="">
    subdomain('https://endpointservices.static.observableusercontent.com')
  </script>
  <script id="67" type="application/vnd.observable.javascript" pinned="">
    notebook()
  </script>
  <script id="4" type="application/vnd.observable.javascript" pinned="">
    firebaseConfig = ({
      // See https://console.firebase.google.com/u/0/project/_/settings/general/web
      apiKey: "AIzaSyD882c8YEgeYpNkX01fhpUDfioWl_ETQyQ",
      authDomain: "endpointservice.firebaseapp.com",
      databaseURL: "https://endpointservice-eu.europe-west1.firebasedatabase.app/",
      projectId: "endpointservice",
      storageBucket: "endpointservice.appspot.com",
      appId: "1:1986724398:web:9b8bc33895b45dd2e095bf",
      uiConfig: { // https://github.com/firebase/firebaseui-web#configuration
        signInOptions: ["google.com", "facebook.com", "phone", "github.com"],
        // tosUrl: '<your-tos-url>', // Terms of service url.
        // privacyPolicyUrl: '<your-privacy-policy-url>', // Privacy policy url.
      },
    })
  </script>
  <script id="76" type="application/vnd.observable.javascript">
    async function signinWithAccessToken(access_token) {
      const credential = firebase.firebase_.auth.GoogleAuthProvider.credential(
        null,
        access_token
      );
      return await firebase.auth().signInWithCredential(credential);
    }
  </script>
  <script id="6" type="application/vnd.observable.javascript">
    import {viewof user, firebase, listen} with {firebaseConfig as firebaseConfig} from '@tomlarkworthy/firebase'
  </script>
  <script id="79" type="application/vnd.observable.javascript">
    import {getAccessTokenFromServiceAccount} from '@tomlarkworthy/firebase-admin'
  </script>
  <script id="122" type="application/vnd.observable.javascript">
    import { footer } from "@endpointservices/footer-with-backups"
  </script>
  <script id="126" type="application/vnd.observable.javascript">
    footer
  </script>
</notebook>

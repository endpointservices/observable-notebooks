<!doctype html>
<notebook theme="air">
  <title>Bitcoin Energy Use</title>
  <script id="0" type="application/vnd.observable.javascript">
    md`# Bitcoin Energy Use

    Some people think Bitcoin is an ecological disaster:

    ${tweet("1350869944888664064")}

    Other people think the ecological case is overblown ([HN](https://news.ycombinator.com/item?id=25881088))

    ![](${await FileAttachment("image@3.png").url()})

    I feel the root of the problem is scale. How much electricity does Bitcoin burn, relative to how much electricity in general we have?
    `
  </script>
  <script id="2" type="application/vnd.observable.javascript">
    md`## Hash Rate over time

    The network hashrate is how much computation is being performed and is a recorded publically on the blockchain.

    ![](${await FileAttachment("image.png").url()})

    source: https://www.blockchain.com/charts/hash-rate
    `
  </script>
  <script id="10" type="application/vnd.observable.javascript">
    hashrate = d3.csvParse(await FileAttachment("hash-rate.csv").text()).map(row => ({
      date: moment(row.Timestamp).toDate(),
      th_per_sec: row['hash-rate']
    })).filter(row => row.date > new Date("2015-01-01T00:00"))
  </script>
  <script id="20" type="application/vnd.observable.javascript">
    md`## ASIC Efficiency over time

    We can look at existing hardware specs to see how fast we can hash/mine at a given point in time.

    source: https://www.asicminervalue.com/`
  </script>
  <script id="63" type="application/vnd.observable.javascript">
    asicminervaluetable = (await FileAttachment("asicminervalue.com").text()).match(
      /(<table[\s\S]*<\/table>)/
    )[1];
  </script>
  <script id="82" type="application/vnd.observable.javascript">
    asic_history = tableExtractor(d3.create("div").html(asicminervaluetable)).map(row => ({...row, th_per_sec_per_watt: ThPerSec(row.Hashrate) / Watts(row.Power), date: new Date(moment(row.Release).toDate())}))
  </script>
  <script id="276" type="application/vnd.observable.javascript">
    best_asic_history = asic_history.sort((a,b) => a.date - b.date).reduce(
      (acc, row) => {
        if (row.th_per_sec_per_watt > acc.best_th_per_sec_per_watt) {
          acc.best_th_per_sec_per_watt = row.th_per_sec_per_watt;
          acc.history.push(row);
        }
        return acc;
      },
      {
        history: [],
        best_th_per_sec_per_watt: 0
      }
    ).history
  </script>
  <script id="268" type="application/vnd.observable.javascript">
    vega({
      data: {values: best_asic_history},
      width,
      height: 500,
      autosize: "fit",
      mark: "line",
      encoding: {
        x: {"field": "Release", "type": "temporal"},
        y: {"field": "th_per_sec_per_watt", "type": "quantitative"}
      }
    })
  </script>
  <script id="324" type="application/vnd.observable.javascript">
    best_th_per_sec_per_watt_at = (date) => {
      return best_asic_history.slice().reverse().find(row => row.date < date).th_per_sec_per_watt
    }
  </script>
  <script id="354" type="application/vnd.observable.javascript">
    md`## Minimum Energy Usage over time

    If we use the most effecient ASIC technology to mine the recorded hashrate, we can see the minimum energy spend
    `
  </script>
  <script id="358" type="application/vnd.observable.javascript">
    power_over_time = hashrate.map(row => {
      const best_th_per_sec_per_watt = best_th_per_sec_per_watt_at(row.date);
      const min_watts = row.th_per_sec / best_th_per_sec_per_watt;
      return {
        ...row,
        best_th_per_sec_per_watt,
        min_watts,
        TWh: min_watts * 60 * 60 * 1.0E-12
      };
    })
  </script>
  <script id="370" type="application/vnd.observable.javascript">
    vega({
      data: {values: power_over_time},
      width,
      height: 500,
      autosize: "fit",
      mark: "line",
      encoding: {
        x: {"field": "date", "type": "temporal"},
        y: {"field": "TWh", "type": "quantitative"}
      }
    })
  </script>
  <script id="373" type="application/vnd.observable.javascript">
    md`# Realistic Energy usage

    The above graph assumes all the miners are using the best hardware available to satsify the hash rate. In the paper:

    *"Bitcoinâ€™s energy consumption is underestimated: A market dynamics approach"* -- **Alexde Vries**
    https://www.sciencedirect.com/science/article/abs/pii/S2214629620302966?via%3Dihub

    Vries tries to estimate the inneffeciency leading to estimate of 87.1 TWh of electrical energy annually on September, 2019 (so about 10x the optimal rate).

    [Statista](https://www.statista.com/statistics/881472/worldwide-bitcoin-energy-consumption/#:~:text=Global%20Bitcoin%20energy%20consumption%202017%2D2020&text=As%20of%20November%202020%2C%20Bitcoin,76.87%20terawatt%20hours%20per%20year) estiamtes energy leveling off at 80TWh

    ![](${await FileAttachment("image@2.png").url()})


    # Worldwide Electricity usage

    So bitcoin is using somewhere in the region on 80TWh to 160TWh. Is that a lot?

    ![](${await FileAttachment("image@1.png").url()})

    World wide energy consumption for *everything* is in the order of 22kTWh, thus Bitcoin is around 0.4% - 0.7% of worldwide consumption.

    Given Bitcoin contributes nothing in my life, and electricity a lot, I think Bitcoin usage is way too high for the niche collection of people it is used by.

    `
  </script>
  <script id="137" type="application/vnd.observable.javascript">
    ThPerSec = (hashrate) => {
      if (hashrate.endsWith('Th/s')) {
        return parseFloat(hashrate.match(/^([+-]?([0-9]*[.])?[0-9]+)/)[0])
      } else if (hashrate.endsWith('Gh/s')) {
        return parseFloat(hashrate.match(/^([+-]?([0-9]*[.])?[0-9]+)/)[0]) * 1e-3
      } else if (hashrate.endsWith('Mh/s')) {
        return parseFloat(hashrate.match(/^([+-]?([0-9]*[.])?[0-9]+)/)[0]) * 1e-6
      } else if (hashrate.endsWith('ksol/s')) {
        return parseFloat(hashrate.match(/^([+-]?([0-9]*[.])?[0-9]+)/)[0]) * 1e-9
      } else if (hashrate.endsWith('h/s')) {
        return parseFloat(hashrate.match(/^([+-]?([0-9]*[.])?[0-9]+)/)[0]) * 1e-12
      }
      throw new Error("Unrecognised unit " + hashrate)
    }
  </script>
  <script id="146" type="application/vnd.observable.javascript">
    viewof ThPerSecTests = createSuite()
  </script>
  <script id="149" type="application/vnd.observable.javascript">
    function ThPerSecTestCase(input, expected) {
      return ThPerSecTests.test(`${input} is ${expected}TH/s`, () => {
        expect(ThPerSec(input)).toBe(expected)
      })
    }
  </script>
  <script id="225" type="application/vnd.observable.javascript">
    Watts = (power) => {
      if (power.endsWith('W')) {
        return parseFloat(power.match(/^([+-]?([0-9]*[.])?[0-9]+)/)[0])
      }
      throw new Error("Unrecognised unit " + hashrate)
    }
  </script>
  <script id="165" type="application/vnd.observable.javascript">
    ThPerSecTestCase("6.6Th/s", 6.6) 
  </script>
  <script id="194" type="application/vnd.observable.javascript">

    ThPerSecTestCase("1Gh/s", 0.001)
  </script>
  <script id="157" type="application/vnd.observable.javascript">
    ThPerSecTestCase("12Mh/s", 0.000012)
  </script>
  <script id="203" type="application/vnd.observable.javascript">
    ThPerSecTests.test(`All Hashrate of asic_history can be converted to Th/s`, () => {
      asic_history.map(row => ThPerSec(row.Hashrate))
    })
  </script>
  <script id="230" type="application/vnd.observable.javascript">
    ThPerSecTests.test(`All Power of asic_history can be converted to W`, () => {
      asic_history.map(row => Watts(row.Power))
    })
  </script>
  <script id="78" type="application/vnd.observable.javascript">
    import {tableExtractor} from '@fil/table-extractor'
  </script>
  <script id="124" type="application/vnd.observable.javascript">
    d3 = require("d3@6")
  </script>
  <script id="143" type="application/vnd.observable.javascript">
    import {createSuite, expect} from '@tomlarkworthy/testing'
  </script>
  <script id="242" type="application/vnd.observable.javascript">
    import {timeSeries} from '@sdaas/d3-timeseries'
  </script>
  <script id="256" type="application/vnd.observable.javascript" pinned="">
    moment = require('moment')
  </script>
  <script id="265" type="application/vnd.observable.javascript" pinned="">
    vega = require("@observablehq/vega-lite@0.1")
  </script>
  <script id="409" type="application/vnd.observable.javascript" pinned="">
    import {tweet} from '@mbostock/tweet'
  </script>
</notebook>

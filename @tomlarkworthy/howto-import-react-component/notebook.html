<!doctype html>
<notebook theme="air">
  <title>Howto import a React component (Chonky Example)</title>
  <script id="0" type="application/vnd.observable.javascript">
    md`# Howto import a React component (Chonky Example)

    There are a lot of useful components already programmed in the React ecosystem. However, they often require nodejs to use. This is my notes on exporting one to AMD module format so that it can be imported into a notebook and used to assemble an application with Observable.

    I have saved the npm package here https://github.com/tomlarkworthy/chonky-adapter
    `
  </script>
  <script id="148" type="application/vnd.observable.javascript">
    md`### Use j-f1's react library for Observablehq`
  </script>
  <script id="4" type="application/vnd.observable.javascript">
    import {
      render,
      component,
      jsx,
      memo,
      forwardRef,
      React,
      ReactDOM,
      createElement,
      Children,
      createRef,
      createContext,
      lazy,
      Fragment,
      StrictMode,
      Suspense,
      cloneElement,
      useCallback,
      useContext,
      useEffect,
      useImperativeHandle,
      useLayoutEffect,
      useMemo,
      useReducer,
      useRef,
      useState,
      useDebugValue,
      createPortal
    } from '@j-f1/react-16'
  </script>
  <script id="155" type="application/vnd.observable.javascript">
    md`#### Create an minimal npm package

    ~~~
        npm init
        npm install chonky@2.1  chonky-icon-fontawesome@2.1 --save-dev
        npm install react@16 react-dom@16 --save-dev 
        npm install webpack@4 webpack-cli@4 --save-dev 
    ~~~`
  </script>
  <script id="159" type="application/vnd.observable.javascript">
    md`#### Create a *webpack.config.js* to bundle an AMD module

    We designate _react_ and _react-dom_ as **external** dependancies so they are not included in the bundle, and that we are building a AMD library.

    ~~~js
    const path = require('path');

    module.exports = [{
      entry: './node_modules/chonky/lib/index.js',
      name: "chonky",
      mode: 'production',
      externals: {
        react: {
          root: 'React',
          amd: 'react',
        },
        'react-dom': {
          root: 'ReactDOM',
          amd: 'react-dom',
        }
      },
      output: {
        path: path.resolve(__dirname, 'dist'),
        filename: 'chonky-amd.js',
        library: "chonky",
        libraryTarget: 'amd'
      },
    }, {
      entry: './node_modules/chonky-icon-fontawesome/lib/index.js',
      name: "chonky-icons",
      mode: 'production',
      externals: {
        react: {
          root: 'React',
          amd: 'react',
        }
      },
      output: {
        path: path.resolve(__dirname, 'dist'),
        filename: 'chonky-icons-amd.js',
        library: "chonkyicons",
        libraryTarget: 'amd'
      },
    }];
    ~~~`
  </script>
  <script id="166" type="application/vnd.observable.javascript">
    md`#### Import the artifacts

    We include a require.alias so that j-f1's react library is used as the react(-dom) dependency.
    `
  </script>
  <script id="36" type="application/vnd.observable.javascript" pinned="">
    chonky = require.alias({
      react: React, // We are bringing these from @j-f1/react
      "react-dom": ReactDOM
    })(await FileAttachment("chonky-amd@2.js").url())
  </script>
  <script id="136" type="application/vnd.observable.javascript" pinned="">
    chonky_icons = require.alias({
      react: React // We are bringing these from @j-f1/react
    })(await FileAttachment("chonky-icons-amd@1.js").url())
  </script>
  <script id="174" type="application/vnd.observable.javascript">
    md`### DONE!

    Now lets try out Chonky filebrowser react component!
    `
  </script>
  <script id="115" type="application/vnd.observable.javascript" pinned="">
    files = [
      { id: 'lht', name: 'Projects', isDir: true },
      {
        id: 'mcd',
        name: 'chonky-sphere-v2.png',
        thumbnailUrl: 'https://chonky.io/chonky-sphere-v2.png'
      }
    ]
  </script>
  <script id="119" type="application/vnd.observable.javascript" pinned="">
    chonky_defaults = chonky.setChonkyDefaults({
      iconComponent: chonky_icons.ChonkyIconFA
    })
  </script>
  <script id="117" type="application/vnd.observable.javascript" pinned="">
    folderChain = [{ id: 'xcv', name: 'Demo', isDir: true }]
  </script>
  <script id="179" type="application/vnd.observable.javascript">
    md`## Drum roll...`
  </script>
  <script id="102" type="application/vnd.observable.javascript" pinned="">
    {
      chonky_defaults; // Ensure our font is loaded
      return render(
        // We can use j-f1's JSX and depend on our imported React component!
        () =>
          jsx`<${chonky.FullFileBrowser} files=${files} folderChain=${folderChain}></>`
      );
    }
  </script>
  <script id="190" type="application/vnd.observable.javascript">
    md`Whats cool is Observable's reactive behaviour will redraw the folder view if _files_ changes, wow! React AND Observable ðŸ˜Ž`
  </script>
</notebook>

<!doctype html>
<notebook theme="air">
  <title>Save source to clipboard</title>
  <script id="0" type="text/markdown">
    # Save source to clipboard

    ```js
    import {cellsToClipboard} from '@tomlarkworthy/cells-to-clipboard'
    ```

    Fork of [@tophtucker/generate-copied-cells](https://observablehq.com/@tophtucker/generate-copied-cells) to expose just the raw function. It won't work unless its executing during event handling

  </script>
  <script id="42" type="application/vnd.observable.javascript" pinned="">
    copyCellButton(["x = Math.sin(now / 1000)", "y = Math.round(x * 10)"])
  </script>
  <script id="36" type="application/vnd.observable.javascript" pinned="">
    copyCellButton([{type: "md", value: "# Hello"}, "now"])
  </script>
  <script id="142" type="text/markdown">
    Once you click “Copy cells”, press Esc to focus the main page and then Cmd-V.
  </script>
  <script id="31" type="text/markdown">
    ---
    ## Implementation
  </script>
  <script id="182" type="application/vnd.observable.javascript" pinned="">
    cellsToClipboard = (cells) => {
      function listener(e) {
        e.clipboardData.setData("text/plain", cells.join("\n\n"));
        e.clipboardData.setData(
          "application/vnd.observablehq+json",
          JSON.stringify(cells.map(makeCell))
        );
        e.preventDefault();
      }
      document.addEventListener("copy", listener);
      document.execCommand("copy");
      document.removeEventListener("copy", listener);
    }
  </script>
  <script id="5" type="application/vnd.observable.javascript" pinned="">
    copyCellButton = (cells) =>
      Inputs.button("Copy cells", { reduce: () => cellsToClipboard(cells) })
  </script>
  <script id="9" type="application/vnd.observable.javascript" pinned="">
    makeCell = (value) => {
      const id = mutable id++;
      if (typeof value === "string") {
        return { ...defaultJS, id, value };
      } else if (typeof value === "object") {
        if (value.type === "js") return { ...defaultJS, id, ...value };
        return { ...defaultOther, id, ...value };
      } else {
        throw new Error("Value must be string or object");
      }
    }
  </script>
  <script id="171" type="application/vnd.observable.javascript" pinned="">
    defaultJS = ({
      id: 0,
      value: "",
      pinned: true,
      mode: "js",
      data: null,
      name: null
    });
  </script>
  <script id="175" type="application/vnd.observable.javascript" pinned="">
    defaultOther = ({
      id: 0,
      value: "",
      pinned: false,
      mode: "md",
      data: null,
      name: ""
    })
  </script>
  <script id="10" type="application/vnd.observable.javascript" pinned="">
    // I don't think pasting cells even looks at their IDs but this lets them autoincrement
    mutable id = 0
  </script>
</notebook>

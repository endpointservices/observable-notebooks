<!doctype html>
<notebook theme="air">
  <title>Colossal Cave ChatGPT Challenge</title>
  <script id="0" type="text/markdown">
    # Colossal Cave ChatGPT Challenge

    Devise a system prompt that scores well on the 1976 classic "Colossal Cave Adventure". I've scored 93 on GPT3.5-turbo! but I think more is possible and I have never run GPT-4 (I don't have access).

    You can look up the score by typing `score` in the `adventure_input`.

    I made this to learn how AutoGPT-like techniques can work on a problem well suited to the ChatGPT interface. As I have played with it I have experienced how certain prompt techniques like chain-of-thought provide huge boosts in task performance, but the game is tricky, there are random elements so this is not enough. Is a perfect score of 350 achievable? Let me know of your progress in the notebook comments (in left burger menu) or on [Twitter](https://twitter.com/tomlarkworthy/status/1650145775014273025?s=20) (maybe post the game output to a gist)

  </script>
  <script id="369" type="text/markdown">
    <details>
      <summary>Confirming your key privacy</summary>
      ${md`This notebook stores your OPENAI_API_KEY in localstorage so it's there when you refresh the page. Other than that the only time it is accessed is when making an OpenAI call. You can verify this by searching for OPENAI_API_KEY references using the search feature in the right sidebar.

      This notebook is hosted by [observablehq.com](https://observablehq.com/). They do not inspect the internal state of notebook. See their [security policy](https://observablehq.com/@observablehq/security-and-data-access-demo).`}

      => Your key is never disclosed to any party other than OpenAI
    </details>
  </script>
  <script id="136" type="application/vnd.observable.javascript">
    viewof OPENAI_API_KEY = Inputs.bind(
      Inputs.password({
        label: "OPENAI_API_KEY",
        placeholder: "paste openAI key here"
      }),
      localStorageView("OPENAI_API_KEY")
    )
  </script>
  <script id="344" type="application/vnd.observable.javascript">
    viewof model = Inputs.select(
      [
        "gpt-3.5-turbo-1106",
        "gpt-3.5-turbo",
        "gpt-3.5-turbo-0301",
        "gpt-3.5-turbo-0613",
        "gpt-3.5-turbo-16k",
        "gpt-3.5-turbo-16k-0613",
        "gpt-3.5-turbo-instruct",
        "gpt-3.5-turbo-instruct-0914",
        "gpt-4-1106-preview",
        "gpt-4",
        "gpt-4-32k",
        "gpt-4-0314",
        "gpt-4-0613",
        "gpt-4-turbo",
        "gpt-4-turbo-2024-04-09",
        "gpt-4-turbo-preview",
        "gpt-4-vision-preview",
        "gpt-4o",
        "gpt-5-mini"
      ].sort(),
      {
        label: "model"
      }
    )
  </script>
  <script id="131" type="application/vnd.observable.javascript" pinned="">
    settings = ({
      temperature: 1,
      max_completion_tokens: 500,
      top_p: 1,
      frequency_penalty: 0,
      presence_penalty: 0
    })
  </script>
  <script id="583" type="application/vnd.observable.javascript">
    Plot.plot({
      marks: [Plot.line(game_history, { x: "turn", y: "score" })]
    })
  </script>
  <script id="450" type="text/markdown">
    Enter your prompt here, then press start and follow its adventure below
  </script>
  <script id="365" type="text/markdown">
    <details>
      <summary>prompt hints</summary>
      <details>
        <summary>Score 2 (GPT 3.5 and 4o): Game mechanics only</summary>
    ${md`
    ~~~
    Act as a player in a 1970 text adventure game trying to get a good score. I will read the description and YOU MUST RESPOND WITH TWO WORDS. One VERB and one NOUN. DO NOT add any additional words or a different form. Do not apologize. DO NOT ASK A QUESTION.

    The verbs are:

    carry
    drop
    say
    unlock
    light
    extinguish
    wave
    attack
    pour
    eat
    drink
    rub
    throw
    find
    feed
    fill
    blast
    read
    break
    wake
    suspend


    The nouns are: 

    upstream downstream forest
    forward continue onward return retreat valley staircase outside building stream
    cobble inward inside surface nowhere passage tunnel canyon awkward
    upward ascend downward descend outdoors barren across debris broken
    examine describe slabroom depression entrance secret bedquilt plover
    oriental cavern reservoir office headlamp lantern pillow velvet fissure tablet
    oyster magazine spelunker dwarves knives rations bottle mirror beanstalk
    stalactite shadow figure drawings pirate dragon message volcano geyser
    machine vending batteries carpet nuggets diamonds silver jewelry treasure
    trident shards pottery emerald platinum pyramid pearl persian spices capture
    release discard mumble unlock nothing extinguish placate travel proceed
    continue explore follow attack strike devour inventory detonate ignite
    blowup peruse shatter disturb suspend sesame opensesame abracadabra
    shazam excavate information

    DO NOT WRITE ANYTHING OTHER THAN THE COMMAND.

    tips for getting a good score:
    take all the items in the building and go downstream and unlock the grate. Explore the caves within. To to visit as many different places as possible.
    ~~~`}
        </details>
        <details>
          <summary>Score 37: walkthrough from the internet</summary>
    ${md`

    I pasted a solution from https://strategywiki.org/wiki/Colossal_Cave_Adventure/Walkthrough and it did pretty well but often lost its place in the instructions

    ~~~
    Act as a player in a 1970 text adventure game trying to get a good score. I will read the description and YOU MUST RESPOND WITH WITH THE NEXT COMMAND. Here are the commands

    e
    get lamp
    xyzzy
    on lamp
    e
    get cage
    pit
    e
    get bird
    w
    d
    s
    get gold
    n
    n
    free bird
    drop cage
    s
    get jewel
    n
    w
    get coins
    e
    n
    get silver
    n
    plover
    ne
    get pyramid
    s
    plover
    plugh
    drop pyramid
    drop coins
    drop jewel
    drop silver
    drop gold
    get bottle
    get food
    get keys
    plugh
    s
    d
    bedquilt
    slab
    s
    d
    pour water
    u
    w
    u
    reservoir
    get water
    s
    s
    d
    s
    d
    pour water
    u
    e
    d
    get oil
    u
    w
    d
    climb
    w
    get eggs
    n
    oil door
    n
    get trident
    w
    d
    drop bottle
    sw
    u
    toss eggs
    cross
    ne
    barren
    e
    feed bear
    open chain
    get chain
    get bear
    w
    fork
    ne
    e
    get spice
    fork
    w
    w
    cross
    free bear
    cross
    sw
    d
    drop keys
    bedquilt
    e
    n
    open clam
    d
    d
    get pearl
    u
    u
    s
    u
    e
    u
    n
    plugh
    drop chain
    drop spice
    drop trident
    drop pearl
    plugh
    s
    d
    bedquilt
    w
    oriental
    n
    w
    drop lamp
    drop axe
    e
    get emerald
    w
    get axe
    get lamp
    nw
    s
    get vase
    se
    e
    get pillow
    w
    w
    w
    d
    climb
    w
    fee
    fie
    foe
    foo
    get eggs
    s
    d
    u
    w
    u
    s
    kill dragon
    yes
    get rug
    e
    e
    n
    n
    plugh
    drop rug
    drop pillow
    drop vase
    drop emerald
    drop eggs
    xyzzy
    get rod
    pit
    d
    w
    wave rod
    w
    get diamond
    w
    s
    e
    s
    s
    s
    n
    e
    n
    e
    nw
    get chest
    get diamond
    se
    n
    d
    debris
    xyzzy
    drop rod
    drop chest
    drop diamond
    plugh
    s
    d
    bedquilt
    e
    e
    get magazine
    e
    drop magazine
    n
    sw
    get rod
    ne
    drop rod
    sw
    blast
    ~~~
    `}
        </details>
        <details>
        <summary>Score (GPT3.5: 93, GPT4o: 97), Walkthrough + Chain of Thought</summary>
    ${md`

    To help the assistant keep its place in the walkthrough I numbered the steps and asked it to output the step before the command. It performed so well that the context token size grew large enough to require truncation. It can't achieve a perfect score though because there are random elements in the game like the dwarves that mess the run up.

    ~~~
    Act as a player in a 1970 text adventure game trying to get a good score.

    I will read the description and YOU MUST RESPOND WITH WITH THE STEP NUMBER ON THE FIRST LINE AND THE NEXT COMMAND ON THE SECOND LINE. If you are dealing with a random event like the dwarves, omit the STEP NUMBER 

    This is a walkthrough for the 350-point version of the Colossal Caves Adventure by Crowther and Woods. It begins at the start of the game outside the building, and is (more or less) the exact commands needed to win the game with the maximum number of points. This walkthrough will not solve any of the versions which have more total points. It assumes that you don't find the first dwarf (the one who throws the axe) before completing the first trip into the cave (else you'll have too many items to carry). It also assumes that you will pick up the axe as soon as you see it, and kill the other dwarves you see as you see them, and retrieve the axe afterwards. It also assumes that the pirate doesn't steal any treasure until you actually get into the maze of twisty little passages, all alike, or else you'll have to modify the chest-retrieval bit to account for it. Due to these random events, and certain other ones like passages occasionally dumping you into the same room you left from, this is not an exact walkthrough, and feeding the inputs shown into the game via input redirection will not work (unfortunately). You have to deal with the extra events as they happen, and maybe try several times before circumstances work out and you win the game.

    1. e
    2. get lamp
    3. xyzzy
    4. on lamp
    5. e
    6. get cage
    7. pit
    8. e
    9. get bird
    10. w
    11. d
    12. s
    13. get gold
    14. n
    15. n
    16. free bird
    17. drop cage
    18. s
    19. get jewel
    20. n
    21. w
    22. get coins
    23. e
    24. n
    25. get silver
    26. n
    27. plover
    28. ne
    29. get pyramid
    30. s
    31. plover
    32. plugh
    33. drop pyramid
    34. drop coins
    35. drop jewel
    36. drop silver
    37. drop gold
    38. get bottle
    39. get food
    40. get keys
    41. plugh
    42. s
    43. d
    44. bedquilt
    45. slab
    46. s
    47. d
    48. pour water
    49. u
    50. w
    51. u
    52. reservoir
    53. get water
    54. s
    55. s
    56. d
    57. s
    58. d
    59. pour water
    60. u
    61. e
    62. d
    63. get oil
    64. u
    65. w
    66. d
    67. climb
    68. w
    69. get eggs
    70. n
    71. oil door
    72. n
    73. get trident
    74. w
    75. d
    76. drop bottle
    77. sw
    78. u
    79. toss eggs
    80. cross
    81. ne
    82. barren
    83. e
    84. feed bear
    85. open chain
    86. get chain
    87. get bear
    88. w
    89. fork
    90. ne
    91. e
    92. get spice
    93. fork
    94. w
    95. w
    96. cross
    97. free bear
    98. cross
    99. sw
    100. d
    101. drop keys
    102. bedquilt
    103. e
    104. n
    105. open clam
    106. d
    107. d
    108. get pearl
    109. u
    110. u
    111. s
    112. u
    113. e
    114. u
    115. n
    116. plugh
    117. drop chain
    118. drop spice
    119. drop trident
    120. drop pearl
    121. plugh
    122. s
    123. d
    124. bedquilt
    125. w
    126. oriental
    127. n
    128. w
    129. drop lamp
    130. drop axe
    131. e
    132. get emerald
    133. w
    134. get axe
    135. get lamp
    136. nw
    137. s
    138. get vase
    139. se
    140. e
    141. get pillow
    142. w
    143. w
    144. w
    145. d
    146. climb
    147. w
    148. fee
    149. fie
    150. foe
    151. foo
    152. get eggs
    153. s
    154. d
    155. u
    156. w
    157. u
    158. s
    159. kill dragon
    160. yes
    161. get rug
    162. e
    163. e
    164. n
    165. n
    166. plugh
    167. drop rug
    168. drop pillow
    169. drop vase
    170. drop emerald
    171. drop eggs
    172. xyzzy
    173. get

    For example, your first output should be:

    1
    e
    ~~~
    `}
        </details>
        <summary>Prompt Tip Template</summary>
    ${md`
    ~~~

    ~~~
    `}
        </details>
    </details>
  </script>
  <script id="107" type="application/vnd.observable.javascript">
    viewof system_prompt = Inputs.bind(
      Inputs.textarea({
        placeholder: "write your prompt here... suggestions above",
        rows: 10
      }),
      localStorageView("collosal_cave_prompt")
    )
  </script>
  <script id="174" type="application/vnd.observable.javascript">
    viewof run = Inputs.button("start/step/continue")
  </script>
  <script id="319" type="application/vnd.observable.javascript">
    viewof auto_run = Inputs.toggle({
      label: "auto-run",
      value: true
    })
  </script>
  <script id="330" type="application/vnd.observable.javascript">
    viewof reset = Inputs.button("reset game", {
      reduce: (acc) => {
        viewof auto_run.value = false;
        return acc + 1;
      }
    })
  </script>
  <script id="12" type="text/html">
    <div style="height: 200px; overflow: scroll; font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace; color: #0F0; background: black; padding: 10px">
      ${html`${output}`}
    </div>
  </script>
  <script id="17" type="application/vnd.observable.javascript">
    viewof adventure_input = {
      reset;
      return Inputs.textarea({
        label: "adventure input",
        placeholder: ">",
        submit: true
      });
    }
  </script>
  <script id="396" type="text/markdown">
    💡 You can manually type `score` ^^
  </script>
  <script id="638" type="text/markdown">
    ---
  </script>
  <script id="465" type="text/markdown">
    ---
  </script>
  <script id="615" type="application/vnd.observable.javascript">
    viewof delay = Inputs.range([0, 120], {
      value: 2,
      label: "pause between actions"
    })
  </script>
  <script id="459" type="text/markdown">
    ## Code

    below is the bulk of the implementation
  </script>
  <script id="417" type="text/markdown">
    ### Open AI
  </script>
  <script id="289" type="application/vnd.observable.javascript">
    ai_context = {
      await new Promise((next) => setTimeout(next, viewof delay.value * 1000));
      return game_history
        .flatMap((entry) => [
          {
            role: "assistant",
            content: entry.input
          },
          {
            role: "user",
            content: entry.response
          }
        ])
        .slice(-70, -1);
    }
  </script>
  <script id="122" type="application/vnd.observable.javascript">
    openAiResponse = {
      if (run == 0) throw new Error("Press start/continue to begin");
      if (!auto_run) throw new Error("Toggle auto-run to continue");
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${OPENAI_API_KEY}`
        },
        body: JSON.stringify({
          model: viewof model.value,
          messages: [
            {
              role: "system",
              content: viewof system_prompt.value
            },
            ...ai_context
          ],
          ...settings
        })
      });

      if (response.status !== 200)
        throw new Error(`${response.status}: ${await response.text()}`);

      return response.json();
    }
  </script>
  <script id="262" type="application/vnd.observable.javascript">
    ai_choice = openAiResponse.choices[0].message.content
  </script>
  <script id="272" type="application/vnd.observable.javascript">
    ai_to_adventure = {
      viewof adventure_input[0].value = ai_choice;
      viewof adventure_input.dispatchEvent(new Event("submit"));
    }
  </script>
  <script id="409" type="text/markdown">
    ### [Adventurejs](https://www.npmjs.com/package/adventurejs)
  </script>
  <script id="4" type="application/vnd.observable.javascript">
    adventure = import("https://cdn.skypack.dev/adventurejs@1.0.1?min")
  </script>
  <script id="7" type="application/vnd.observable.javascript">
    game = {
      reset;
      return adventure.makeState();
    }
  </script>
  <script id="33" type="application/vnd.observable.javascript" pinned="">
    on_input = {
      // Tick the game when new "adventure_input" arrives
      const masked_input = adventure_input.split("\n").slice(-1);
      const adventure_response = game.advance(masked_input).join(" ");
      const score = parseInt(
        (/(\d+)/.exec(
          adventure
            .makeState(JSON.parse(JSON.stringify(game)))
            .advance("score")
            .find((x) => x.startsWith("SCORE"))
        ) || ["0", "0"])[1]
      );

      // Record history
      viewof game_history.value.push({
        input: adventure_input,
        response: adventure_response,
        score,
        turn: (viewof game_history.value.slice(-1)[0]?.turn || 0) + 1
      });
      viewof game_history.dispatchEvent(new Event("input"));

      // Render to HTML
      mutable output =
        mutable output + "<br>> " + adventure_input + "<br>" + adventure_response;

      if (game.state == "init_yesno") {
        // Auto-play the instructions part
        viewof adventure_input[0].value = "no";
        viewof adventure_input.dispatchEvent(new Event("submit"));
      } else {
        viewof adventure_input.value = "";
      }
      return `${adventure_input} -> ${adventure_response}`;
    }
  </script>
  <script id="47" type="application/vnd.observable.javascript">
    mutable output = {
      reset;
      return "";
    }
  </script>
  <script id="280" type="application/vnd.observable.javascript">
    viewof game_history = {
      reset;
      return Inputs.input([]);
    }
  </script>
  <script id="463" type="text/markdown">
    ### Misc
  </script>
  <script id="89" type="application/vnd.observable.javascript">
    ui_loop = {
      view.scrollTop = view.scrollHeight;
    }
  </script>
  <script id="161" type="application/vnd.observable.javascript">
    import { localStorageView } from "@tomlarkworthy/local-storage-view"
  </script>
  <script id="526" type="application/vnd.observable.javascript">
    import { footer } from "@endpointservices/footer-with-backups"
  </script>
  <script id="545" type="application/vnd.observable.javascript">
    footer
  </script>
</notebook>

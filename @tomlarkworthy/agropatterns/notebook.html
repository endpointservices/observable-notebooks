<!doctype html>
<notebook theme="air">
  <title>Agropatterns on WebCode</title>
  <script id="0" type="text/markdown">
    # Agropatterns on WebCode
  </script>
  <script id="77" type="text/markdown">
    ### 8th June 2022 Fortune
  </script>
  <script id="68" type="text/markdown">
    https://thetarot.online/-N42NHEPbBsiwdilM5oP
  </script>
  <script id="72" type="text/html">
    <img src="https://storage.googleapis.com/download/storage/v1/b/larkworthy-dfb11.appspot.com/o/@tomlarkworthy%2Ftarot-backend%2Fimages%2F-N42NHEPbBsiwdilM5oP?generation=1654692851186510&alt=media">
  </script>
  <script id="106" type="text/markdown">
    ## June 9 Fortune
  </script>
  <script id="101" type="text/markdown">
    https://thetarot.online/-N47w0hPDECBxl4k7y7I
  </script>
  <script id="108" type="application/vnd.observable.javascript">
    screenShot20220609At105843Am = FileAttachment("Screen Shot 2022-06-09 at 11.00.39 AM.png").image({width: 800})
  </script>
  <script id="8" type="text/markdown">
    ## Questions
  </script>
  <script id="36" type="text/markdown">
    ## Agropatterns Vision new version
    - Conflict on people upvoting at same time
    - PDF
    - QR codes
    - Offline first - Users in field uploading information about observations (i.e. multiple blights per square - about 10 squares per bed and 200 beds per greenhouse). Some of our clients have as many as 50 greenhouses in their farms.
    - need distilled information (highlight areas of concern), bot messaging them directly to take action
    - The application is accounting for agriculture
    - Sticky traps for insects (count a couple times a week).
    - New sensors for realtime data (temperature, humidity)
    - Predictive analytics (extrapolate temperature)
    - Target dates (e.g. crops)
    - Large amounts of historical data. IoT as well as Field Observations.
  </script>
  <script id="40" type="text/markdown">
    ## High importance

    - Whitelabeling.
    - Offline first support in Observable.
    - [Blues Wireless](www.blues.io) tech (i.e Notecard + Notehub) (CEO - Ray Ozzie). Good working relationship w/ them.
    - **WhatsApp dialogue interface.** Seems there are some products out there that do just that - may be straightforward to develop our own. Top Priority given that our users are mostly out in the field. Query but also updates via simple forms (e.g. Change from Programmed Countermeasures to Applied and add time of application). NL interface would be really cool.


    Storage: we will use Firebase short term
  </script>
  <script id="54" type="text/markdown">
    ### Existing techs
    - Papertrail
    - React / React native
    - Antd as components
    - Mongo
    - Mongo Atlas
    - Meteor Galaxy
    - GraphQL
    - Mapbox
    - Expo

  </script>
  <script id="10" type="text/markdown">
    ## Twitch checklist
    - Guest uses skype
    - OBS has virtual camera setting on, skype connection switch to OBS virtual camera, so guest sees stream view
    - Observable notebook shared with guest

  </script>
  <script id="14" type="text/markdown">
    ## Stream 1 Script

    - Tom: Intro  (hello welcome to first stream etc.)
    - Tom: Segue to Gabriel (Tell us about Agropatterns)
    - Gabriel: _pitch_
    - Tom: Intro to series: We will stream every week or two weeks various aspects of Agropatterns. So maybe pick a technical challange and determine a solution. What are you hoping to build with WEBCode/observable
    - Gabriel:...
    - Tom: So we need to break this down into streamable chunks. (chunks). But for this week lets concentrate on setting up the webcode environment, so we can do live debugging, and just get the basics working.
  </script>
  <script id="95" type="text/markdown">
    ## Stream 2 Script

    ```

    - Tom: Intro, 
           Daily Tarot reading, lol
           I am excited to ... today let's try a... webhook...
           Gabriel show us around your use of Blues Mobile
    - Gabriel: ... shreenshare of dashboard stories...
               ...
               ... stories of waste
               ...
               ... and we can send that data on
    - Tom
           ...<create route>
           ...<create webhook>
           ...<demo livecoding>
           ...<demo flowQueue>
           ...<demo realtime dashbord>

    ```
  </script>
  <script id="118" type="text/markdown">
    ## Demo
  </script>
  <script id="120" type="application/vnd.observable.javascript">
    import { endpoint } from "@endpointservices/webcode"
  </script>
  <script id="143" type="application/vnd.observable.javascript" pinned="">
    webhook = endpoint("blues_webhook", async (req, res, ctx) => {
      console.log(req);
      try {
        await viewof event.send({
          req,
          res,
          ctx
        });
        res.send("OK");
      } catch (err) {
        res.status(err.code || 500).send(err.message);
      }
    })
  </script>
  <script id="152" type="application/vnd.observable.javascript">
    import { flowQueue } from "@tomlarkworthy/flow-queue"
  </script>
  <script id="175" type="application/vnd.observable.javascript" pinned="">
    viewof event = flowQueue({
      timeout_ms: 10000
    })
  </script>
  <script id="215" type="application/vnd.observable.javascript">
    event
  </script>
  <script id="220" type="application/vnd.observable.javascript" pinned="">
    event.req.headers
  </script>
  <script id="218" type="application/vnd.observable.javascript" pinned="">
    checkAuth = {
      if (
        event.req.headers.authorization ===
        `Basic ${event.ctx.secrets["AGROPATTERNS"]}`
      ) {
      } else {
        const err = new Error("Unauthorized");
        err.code = 403;
        viewof event.reject(err);
        return invalidation;
      }
    }
  </script>
  <script id="192" type="application/vnd.observable.javascript">
    sensor = (checkAuth, JSON.parse(event.req.body))
  </script>
  <script id="202" type="application/vnd.observable.javascript" pinned="">
    uploadToFirbase = {
      sensor;
      return Promises.delay(1000, "OK");
    }
  </script>
  <script id="209" type="application/vnd.observable.javascript" pinned="">
    viewof event.respond(uploadToFirbase)
  </script>
  <script id="177" type="application/vnd.observable.javascript" pinned="">
    event.req.headers
  </script>
</notebook>

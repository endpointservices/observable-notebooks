<!doctype html>
<notebook theme="air">
  <title>ðŸ‘‹ Hello Browser FS Access</title>
  <script id="0" type="text/markdown">
    # ðŸ‘‹ Hello [Browser FS Access](https://developer.chrome.com/docs/capabilities/browser-fs-access)

    Progressive enhancement API for wrapping the File System Access API with fallbacks.

    Unlike the [File System Access API](https://observablehq.com/@tomlarkworthy/file-system-api), this works within Observable (despite iframe), but will use the more performance File System Access API when possible.
  </script>
  <script id="75" type="application/vnd.observable.javascript" pinned="">
    browser_fs = import(
      "https://unpkg.com/browser-fs-access@0.37.0/dist/index.modern.js?module"
    )
  </script>
  <script id="8" type="application/vnd.observable.javascript" pinned="">
    viewof triggerFile = Inputs.button("choose directory")
  </script>
  <script id="16" type="application/vnd.observable.javascript" pinned="">
    files = {
      triggerFile;
      return Array.fromAsync((await browser_fs.directoryOpen()).entries());
    }
  </script>
  <script id="58" type="application/vnd.observable.javascript">
    Inputs.table(
      await Promise.all(
        files.map(async ([name, file]) => {
          const text = await file.text();
          return {
            name: file.name,
            content: text.slice(0, 100)
          };
        })
      )
    )
  </script>
  <script id="19" type="application/vnd.observable.javascript">
    import { exporter } from "@tomlarkworthy/exporter"
  </script>
  <script id="42" type="text/markdown">
    The direct File System Access API does not work in an Observable notebooks because the notebook is inside an cross-origin iframe. We can work around that though (it also doesn't work in Safari or Firefox). The following tool will export this notebook to a separate tab (Preview), or serialize to a single HTML file (Download), so you can see the slightly different behaviour of the Browser FS API.
  </script>
  <script id="25" type="application/vnd.observable.javascript">
    exporter()
  </script>
</notebook>

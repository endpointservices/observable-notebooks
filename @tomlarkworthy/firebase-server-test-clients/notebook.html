<!doctype html>
<notebook theme="air">
  <title>Firebase Server Test Clients</title>
  <script id="0" type="text/markdown">
    # Firebase Server Test Clients
  </script>
  <script id="12" type="application/vnd.observable.javascript" pinned="">
    config = ({
      firebaseServer: {
        url:
          "https://webcode.run?ns=tomlarkworthy|firebase-server-prototype-1;server"
      }
    })
  </script>
  <script id="30" type="application/vnd.observable.javascript">
    viewof restartClient = Inputs.button("restart clients")
  </script>
  <script id="14" type="application/vnd.observable.javascript" pinned="">
    appLib = import("https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js")
  </script>
  <script id="15" type="application/vnd.observable.javascript" pinned="">
    rtdb = import("https://www.gstatic.com/firebasejs/9.5.0/firebase-database.js")
  </script>
  <script id="17" type="application/vnd.observable.javascript" pinned="">
    firebaseAppA = (restartClient,
    appLib.initializeApp(
      {
        databaseURL: config.firebaseServer.url
      },
      Math.random().toString(16) // We randomize the name so we can rerun initialization
    ))
  </script>
  <script id="19" type="application/vnd.observable.javascript" pinned="">
    firebaseAppB = (restartClient,
    appLib.initializeApp(
      {
        databaseURL: config.firebaseServer.url
      },
      Math.random().toString(16) // We randomize the name so we can rerun initialization
    ))
  </script>
  <script id="21" type="application/vnd.observable.javascript" pinned="">
    databaseA = {
      rtdb.enableLogging(true);
      const db = rtdb.getDatabase(firebaseAppA);
      invalidation.then(() => rtdb.goOffline(db));
      return db;
    }
  </script>
  <script id="23" type="application/vnd.observable.javascript" pinned="">
    databaseB = {
      rtdb.enableLogging(true);
      const db = rtdb.getDatabase(firebaseAppB);
      invalidation.then(() => rtdb.goOffline(db));
      return db;
    }
  </script>
  <script id="25" type="application/vnd.observable.javascript" pinned="">
    rootA = rtdb.ref(databaseA, "/")
  </script>
  <script id="27" type="application/vnd.observable.javascript" pinned="">
    rootB = rtdb.ref(databaseB, "/")
  </script>
</notebook>

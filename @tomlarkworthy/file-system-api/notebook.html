<!doctype html>
<notebook theme="air">
  <title>File System Access API</title>
  <script id="0" type="text/markdown">
    # File System Access API

    Note to be confused with the private origin file system (OPFS) or the File System API. The File System Access API lets you read and write files to the host system, i.e. actual files on the user's machine.

    Currently it does not work with Safari or Firefox (2025-05-26). The is a more general ponyfill to get a more general library with [browser FS access](https://observablehq.com/@tomlarkworthy/browser-fs-access)
  </script>
  <script id="8" type="application/vnd.observable.javascript" pinned="">
    viewof triggerFile = Inputs.button("choose directory")
  </script>
  <script id="16" type="application/vnd.observable.javascript" pinned="">
    files = {
      triggerFile;
      return Array.fromAsync((await window.showDirectoryPicker()).entries());
    }
  </script>
  <script id="42" type="text/markdown">
    However, you cannot use the File System API in an Observable notebook because the notebook is inside an cross-origin iframe. We can work around that though. The following tool will export this notebook to a separate tab (Preview), or serialize to a single HTML file (Download) where it works.
  </script>
  <script id="25" type="application/vnd.observable.javascript">
    exporter()
  </script>
  <script id="19" type="application/vnd.observable.javascript">
    import { exporter } from "@tomlarkworthy/exporter"
  </script>
  <script id="58" type="application/vnd.observable.javascript" pinned="">
    Inputs.table(
      await Promise.all(
        files.map(async ([name, handle]) => {
          const file = await handle.getFile();
          const text = await file.text();
          return {
            name,
            content: text.slice(0, 100)
          };
        })
      )
    )
  </script>
</notebook>

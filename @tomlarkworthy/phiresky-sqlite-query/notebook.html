<!doctype html>
<notebook theme="air">
  <title>Network efficient SQLite querying from static file hosting.</title>
  <script id="0" type="application/vnd.observable.javascript">
    md`# Network efficient SQLite querying from static file hosting.

    Just saw https://phiresky.github.io/blog/2021/hosting-sqlite-databases-on-github-pages/ and wanted to see if we could do it here.

    This is extremely cool, a 600MB sqlite database file is hosted on static storage, and we can issue SQL queries, but only a small amount of data is transfered! Yet no backend is really running, its exploiting HTTP range queries. Amazing work Phiresky

    Here I am query data from a Google Cloud bucket provisioned using https://observablehq.com/@endpointservices/storage though I had to enable public access to the files for it to work (i.e. not go through the storage client). So I would suggest using your own bucket for now. I could not use Phiresky's Github pages because of CORS. But this demo shows it definitely will work with Google Cloud Storage buckets. ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥

    `
  </script>
  <script id="76" type="application/vnd.observable.javascript" pinned="">
    Table(results[0].values, {
    })
  </script>
  <script id="117" type="application/vnd.observable.javascript">
    md`## LOOK WE ARE ISSUING SQL ðŸ‘‡`
  </script>
  <script id="63" type="application/vnd.observable.javascript" pinned="">
    results = worker.db.exec(
      `select country_code, long_name from wdi_country limit 10;`
    )
  </script>
  <script id="21" type="application/vnd.observable.javascript" pinned="">
    sqlite = require("sql.js-httpvfs")
  </script>
  <script id="25" type="application/vnd.observable.javascript" pinned="">
    // Magically this gets around same origin policy for running web workers.
    workerUrl = URL.createObjectURL(
      new Blob([await FileAttachment("sqlite.worker@1.js").text()], {
        type: 'application/javascript'
      })
    )
  </script>
  <script id="40" type="application/vnd.observable.javascript" pinned="">
    wasmUrl = FileAttachment("sql-wasm@1.wasm").url()
  </script>
  <script id="32" type="application/vnd.observable.javascript" pinned="">
    worker = await sqlite.createDbWorker(
      [
        {
          from: "jsonconfig",
          configUrl: configURL
        }
      ],
      workerUrl,
      wasmUrl
    )
  </script>
  <script id="74" type="application/vnd.observable.javascript" pinned="">
    import { Table } from '@observablehq/inputs'
  </script>
  <script id="16" type="application/vnd.observable.javascript" pinned="">
    configURL = 'https://storage.googleapis.com/o_endpointservices_mybucket11/public/world-development-indicators-sqlite/split-db/config.json'
  </script>
</notebook>

<!doctype html>
<notebook theme="air">
  <title>Notebook Visualizer for Teams</title>
  <script id="0" type="application/vnd.observable.javascript">
    md`# Notebook Visualizer for Teams

    To use, paste the URL of a public or shared notebook below, or type and click submit. For more on what this graph means, see [How Observable Runs](/@observablehq/how-observable-runs). Use the cell menu <svg viewBox="0 0 8 14" fill="currentColor" stroke="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" width="8" height="14"><circle r="1.5" cx="4" cy="2"></circle><circle r="1.5" cx="4" cy="7"></circle><circle r="1.5" cx="4" cy="12"></circle></svg> below to save your graph as PNG or SVG if desired.

    To share a link to your dependency graph, [click here](?id=${id}).`
  </script>
  <script id="3" type="application/vnd.observable.javascript">
    viewof id = {
      const text = Text({
        value: new URL(location).searchParams.get("id") || "@mbostock/liquidfun",
        submit: true,
        label: "Notebook"
      });
      const input = text.querySelector("input");
      input.addEventListener("input", (event) => {
        let v = input.value, m;
        if (m = /\.js(\?|$)/i.exec(v)) v = v.slice(0, m.index);
        if (m = /^[0-9a-f]{16}$/i.test(v)) v = `d/${v}`;
        if (m = /^https:\/\/(api\.|beta\.|)observablehq\.com\//i.exec(v)) v = v.slice(m[0].length);
        if (v !== input.value) input.value = v;
      });
      input.addEventListener("paste", (event) => {
        Promises.delay(50).then(() => {
          text.dispatchEvent(new Event("submit", {bubbles: true, cancelable: true}));
        });
      });
      return text;
    }
  </script>
  <script id="110" type="application/vnd.observable.javascript">
    viewof orient = Select(new Map([
      ["left-to-right", "LR"],
      ["right-to-left", "RL"],
      ["top-to-bottom", "TB"],
      ["bottom-to-top", "BT"],
    ]), {label: "Orientation"})
  </script>
  <script id="403" type="application/vnd.observable.javascript">
    viewof includes = Checkbox(new Map([
      ["anonymous cells", "anon"],
      ["builtins", "builtin"]
    ]), {label: "Show"})
  </script>
  <script id="435" type="application/vnd.observable.javascript">
    viewof apiKey = {
      const l = localStorageView('API_KEY');
      const i = Inputs.text({
        label: 'API key',
        submit: true,
        value: l.value
      });
      Inputs.bind(i, l);

      i.style.cssText += 'margin-top:.5em';
      const w = html`<details ${i.value ? 'open' : ''}>
        <summary style="font:13px var(--sans-serif);cursor:default">Enable access to private or team notebooks (<a href="https://observablehq.com/@observablehq/api-keys">learn more</a>)</summary>
        ${i}
      `;
      return Object.defineProperty(w, 'value', {
        get: () => i.value,
        set: v => (i.value = v)
      });
    }
  </script>
  <script id="22" type="application/vnd.observable.javascript">
    chart = dot`digraph "${id}" {
    node [fontname="var(--sans-serif)" fontsize=12];
    edge [fontname="var(--sans-serif)" fontsize=12];
    rankdir = ${orient};
    ${Array.from(variables, v => `${v._id} [label = "${v._name || `#${v._id}`}"${v._module === main._runtime._builtin ? `, color = "gray", fontcolor = "#555555"` : ""}]; ${v._inputs.map(i => `${i._id} -> ${v._id} ${v._module !== i._module ? `[color = "#20b2aa"]` : ""};`).join(" ")}`).join("\n")}
    }`
  </script>
  <script id="120" type="application/vnd.observable.javascript">
    md`---`
  </script>
  <script id="12" type="application/vnd.observable.javascript" pinned="">
    main = import(`https://api.observablehq.com/${id}.js?v=3${
      apiKey == null ? '' : `&api_key=${apiKey}`
    }`).then(async ({ default: define }) => {
      const runtime = new Runtime();
      const main = runtime.module(
        define,
        name => includes.includes("anon") || name
      );
      await runtime._compute();
      runtime.dispose();
      return main;
    })
  </script>
  <script id="183" type="application/vnd.observable.javascript" pinned="">
    variables = Array.from(main._runtime._variables, (v, i) => (v._id = i, v))
      .filter(v => !isimport(v) && v._reachable)
      .filter(v => includes.includes("anon") || v._name !== null)
      .filter(v => includes.includes("builtin") || v._module !== main._runtime._builtin)
      .map(v => ({
        _module: v._module,
        _name: v._name,
        _id: v._id,
        _inputs: v._inputs
          .map(i => isimport(i) ? i._inputs[0] : i)
          .filter(i => includes.includes("builtin") || i._module !== main._runtime._builtin)
      }))
  </script>
  <script id="338" type="application/vnd.observable.javascript" pinned="">
    isimport = v => v._inputs.length === 1 && v._module !== v._inputs[0]._module
  </script>
  <script id="172" type="application/vnd.observable.javascript" pinned="">
    Runtime = (await require("@observablehq/runtime@4")).Runtime
  </script>
  <script id="400" type="application/vnd.observable.javascript" pinned="">
    import {Text, Select, Checkbox} from "@observablehq/inputs"
  </script>
  <script id="20" type="application/vnd.observable.javascript" pinned="">
    dot = require("@observablehq/graphviz@0.2")
  </script>
  <script id="437" type="application/vnd.observable.javascript" pinned="">
    import { localStorageView } from '@tomlarkworthy/local-storage-view'
  </script>
</notebook>

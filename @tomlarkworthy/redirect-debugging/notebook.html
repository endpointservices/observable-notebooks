<!doctype html>
<notebook theme="air">
  <title>Redirect Debugging</title>
  <script id="0" type="application/vnd.observable.javascript" pinned="">
    md`# Redirect Debugging`
  </script>
  <script id="4" type="application/vnd.observable.javascript">
    import { deploy } from '@endpointservices/serverless-cells'
  </script>
  <script id="6" type="application/vnd.observable.javascript" pinned="">
    target = deploy("target", async (req, res) => {
      const message = `${req.query.n} ${await randomId()}`;
      console.log(message);
      res.send(message);
    })
  </script>
  <script id="9" type="application/vnd.observable.javascript" pinned="">
    deploy("redirect", async (req, res) => {
      const id = await randomId();
      console.log(`redirect ${id}`);
      res.redirect(302, target.href + "?n=" + id);
    })
  </script>
  <script id="14" type="application/vnd.observable.javascript" pinned="">
    import { randomId } from '@tomlarkworthy/randomid'
  </script>
</notebook>

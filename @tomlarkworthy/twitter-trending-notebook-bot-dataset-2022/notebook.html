<!doctype html>
<notebook theme="air">
  <title>Twitter Trending Notebook Bot Dataset 2022</title>
  <script id="57" type="text/markdown">
    # Twitter Trending Notebook Bot Dataset 2022

  </script>
  <script id="252" type="text/markdown">
    Last year I published [100 Beautiful and Informative Notebooks of 2021](https://observablehq.com/@tomlarkworthy/notebooks2021) and reposted to Medium where it went viral. I will make another this year, but I thought it be good to share the Twitter data early so people can make their own celebrations of Observable excellence.

    ⚠️ Just remember, if you create something fair-use out of other people's work, ensure you credit them! Link them, link the notebook and give the reader context like the title.

    The raw data is in this notebook as FileAttachments, but I did a little data exploration so you can see the power. I will update December on New Year's Day!

  </script>
  <script id="199" type="application/vnd.observable.javascript">
    viewof dimension = Inputs.select(Object.keys(tweets[0]), {
      label: "dimension",
      value: "engagements"
    })
  </script>
  <script id="184" type="application/vnd.observable.javascript">
    viewof bar = Inputs.range([Math.min(...series), Math.max(...series)], {
      label: "The bar"
    })
  </script>
  <script id="167" type="application/vnd.observable.javascript">
    Plot.plot({
      marks: [
        Plot.ruleX(tweets, { x: "time", y: d => +d[dimension] }),
        Plot.ruleY([0]),
        Plot.ruleY([bar], { stroke: "red" })
      ]
    })
  </script>
  <script id="228" type="application/vnd.observable.javascript">
    html`${tweetsAboveTheBar.map(
      (tweet) => html`<iframe border=0 frameborder=0 height=640 width=550
     src="https://twitframe.com/show?url=${encodeURIComponent(
       tweet["Tweet permalink"]
     )}"></iframe>`
    )}`
  </script>
  <script id="226" type="application/vnd.observable.javascript" pinned="">
    tweetsAboveTheBar = tweets.reduce((acc, tweet) => {
      if (tweet[dimension] > bar) acc.push(tweet);
      return acc;
    }, [])
  </script>
  <script id="212" type="application/vnd.observable.javascript">
    series = tweets.map((t) => t[dimension])
  </script>
  <script id="169" type="application/vnd.observable.javascript" pinned="">
    tweets[0]
  </script>
  <script id="40" type="application/vnd.observable.javascript">
    database = {
      const cleanAttachment = async (attachment) =>
        (await attachment.csv()).map((row) => {
          row["time"] = new Date(row["time"]);
          return row;
        });

      const database = await DuckDBClient.of({
        ...Object.fromEntries(
          await Promise.all(
            twitter_files.map(async (attachment) => [
              attachment.name,
              await cleanAttachment(attachment)
            ])
          )
        )
      });
      // Join all the files into tweets table
      database.query(`CREATE TABLE tweets AS (
        ${twitter_files
          .map((attachment) => `select * from "${attachment.name}"`)
          .join("\nUNION ALL\n")}
      )`);
      return database;
    }
  </script>
  <script id="21" type="application/sql" database="var:db">
    select * from tweets
  </script>
  <script id="120" type="application/vnd.observable.javascript">
    twitter_files = [
      FileAttachment(
        "tweet_activity_metrics_trendingnotebo2_20220101_20220201_en.csv"
      ),
      FileAttachment(
        "tweet_activity_metrics_trendingnotebo2_20220201_20220301_en.csv"
      ),
      FileAttachment(
        "tweet_activity_metrics_trendingnotebo2_20220301_20220401_en.csv"
      ),
      FileAttachment(
        "tweet_activity_metrics_trendingnotebo2_20220401_20220501_en.csv"
      ),
      FileAttachment(
        "tweet_activity_metrics_trendingnotebo2_20220501_20220601_en.csv"
      ),
      FileAttachment(
        "tweet_activity_metrics_trendingnotebo2_20220601_20220701_en.csv"
      ),
      FileAttachment(
        "tweet_activity_metrics_trendingnotebo2_20220701_20220801_en.csv"
      ),
      FileAttachment(
        "tweet_activity_metrics_trendingnotebo2_20220801_20220901_en.csv"
      ),
      FileAttachment(
        "tweet_activity_metrics_trendingnotebo2_20220901_20221001_en.csv"
      ),
      FileAttachment(
        "tweet_activity_metrics_trendingnotebo2_20221001_20221101_en.csv"
      ),
      FileAttachment(
        "tweet_activity_metrics_trendingnotebo2_20221101_20221201_en.csv"
      )
      // FileAttachment("tweet_activity_metrics_trendingnotebo2_20221201_2023011_en.csv"),
    ]
  </script>
</notebook>
